#include <stdio.h>
#include <stdint.h>

/* Mark as used so the compiler won't discard the string */
__attribute__((used))
static const char embedded_apis[] =
    "VirtualAlloc\0WriteProcessMemory\0CreateRemoteThread\0GetProcAddress\0LoadLibraryA\0"
    "mmap\0mprotect\0ptrace\0dlopen\0dlsym\0";

/* high-entropy blob (kept and referenced) */
__attribute__((used))
static const unsigned char blob[128] = {
  0x1f,0xa6,0x3c,0x8d,0x9b,0x2f,0x7e,0x5c,0xaf,0x34,0x99,0x44,0xbb,0xcd,0x01,0x77,
  0x12,0x89,0x23,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff,0x00,0x11,
  0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0xaa,0xbb,0xcc,0xdd,0xee,0xff,0x12,0x34,
  0x56,0x78,0x9a,0xbc,0xde,0xf0,0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0x00,
  0x10,0x20,0x30,0x40,0x50,0x60,0x70,0x80,0x90,0xa0,0xb0,0xc0,0xd0,0xe0,0xf0,0xff,
  0xce,0xad,0xfa,0xce,0xbe,0xef,0xca,0xfe,0xba,0xbe,0x0b,0xad,0xf0,0x0d,0x1d,0xea,
  0xde,0xca,0xfb,0xad,0x11,0x22,0x33,0x44,0x55,0x66,0x11,0x23,0x45,0x67,0x89,0xab,
  0xcd,0xef,0x98,0x76,0x54,0x32,0x10,0xfe,0xdc,0xba,0x98,0x76,0x54,0x32,0x10,0x00
};

int main(void) {
    /* reference embedded_apis and blob so they are preserved */
    volatile const char *p = embedded_apis;
    volatile const unsigned char *b = blob;
    (void)p;
    (void)b;
    /* emit an int 0x80 syscall pattern (Linux i386) */
    asm volatile (
        "movl $1, %%eax\n\t"
        "int $0x80\n\t"
        :
        :
        : "eax", "memory"
    );
    printf("injection_mock_i386_fixed: done\n");
    return 0;
}
